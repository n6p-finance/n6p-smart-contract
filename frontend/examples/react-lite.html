<!doctype html>
<html>
<head>
  <meta charset="utf-8" />
  <title>Vault ABI React-lite</title>
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <script crossorigin src="https://unpkg.com/react@17/umd/react.development.js"></script>
  <script crossorigin src="https://unpkg.com/react-dom@17/umd/react-dom.development.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/ethers@5.7.2/dist/ethers.min.js"></script>
  <style>body{font-family:Arial,Helvetica,sans-serif;margin:20px}button{margin-right:8px}</style>
</head>
<body>
  <div id="root"></div>

  <script type="text/javascript">
  const e = React.createElement;
  const ADDRESS = '0x11761e6bDef98e8fa7216dEe36068eD922B24Aaa';

  function App(){
    const [abi, setAbi] = React.useState(null);
    const [status, setStatus] = React.useState('loading ABI...');
    const [totalAssets, setTotalAssets] = React.useState('-');
    const [contract, setContract] = React.useState(null);

    React.useEffect(()=>{
      fetch('../abis/Vault.json').then(r=>r.json()).then(j=>{
        const a = Array.isArray(j)? j : (j.abi || j);
        setAbi(a); setStatus('ABI loaded');
      }).catch(e=>setStatus('ABI load error:'+e));
    },[]);

    async function connect(){
      if(!window.ethereum){ alert('Install MetaMask'); return; }
      await window.ethereum.request({method:'eth_requestAccounts'});
      const provider = new ethers.providers.Web3Provider(window.ethereum);
      const signer = provider.getSigner();
      const c = new ethers.Contract(ADDRESS, abi, signer);
      setContract(c); setStatus('connected');
      try{ const ta = await c.totalAssets(); setTotalAssets(ta.toString()); }catch(e){ setStatus('read error:'+e); }
    }

    async function deposit(){
      if(!contract){ alert('Connect first'); return; }
      const amount = prompt('Amount in smallest units', '1000000000000000000');
      const recipient = await contract.signer.getAddress();
      setStatus('submitting tx...');
      try{ const tx = await contract.deposit(amount, recipient); setStatus('sent: '+tx.hash); await tx.wait(); setStatus('confirmed: '+tx.hash); }catch(e){ setStatus('tx error:'+e); }
    }

    return e('div', null,
      e('h2', null, 'Vault React-lite Demo'),
      e('p', null, `Contract: ${ADDRESS}`),
      e('p', null, `Status: ${status}`),
      e('p', null, e('strong', null, 'TotalAssets: '), totalAssets),
      e('div', null,
        e('button',{onClick:connect}, 'Connect Wallet'),
        e('button',{onClick:deposit}, 'Deposit 1 token (prompt)')
      )
    );
  }

  ReactDOM.render(e(App), document.getElementById('root'));
  </script>
</body>
</html>
